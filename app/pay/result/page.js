"use client"
import Loading from '@/components/global/Loading';
import { BASE_URL, DOMAIN } from '@/utils/constans';
import axios from 'axios';
import { useRouter } from 'next/navigation'
import {useEffect , useState} from 'react'

export const metadata = {
    title: 'نتیجه پرداخت',
    description: 'Generated by create next app',
}

const Result = (props) => {
  const [data, setdata] = useState(null);
  const router = useRouter();
  const { searchParams } = props;


  const getData = async () => {
          await axios.post(`${BASE_URL}/user/payment/verifyNextPay`,searchParams,{withCredentials:true}).then(response => {
          if(response.data.success){
            setdata(response.data.data)
          }else{
            console.log(response.data.messgae)
          }
      }).catch(err => {
          console.log(err.messgae)
      })
  }

  useEffect(() => {
    getData()
  }, [])
  

  return (
    <div className='container'>
      {
        data && 
      <>
       {
          (searchParams.np_status === 'Unsuccessful')?
          <h1>پرداخت شما نا موفق بود</h1>
          :
          <h1>پرداخت شما موفق بود</h1>
        }

        <div className='mt10'>
          <span>شماره پیگیری : </span>
          <span>{searchParams.order_id}</span>
        </div>

        <div className='mt10'>
          <span>مبلغ : </span>
          <span>{searchParams.amount}</span>
        </div>
      </>

      }
       
    </div>
  )
}

export default Result;

// export async function getServerSideProps(context) {
//   const { cookies } = context.req;
 
//   // تنظیم کوکی‌ها
//   const cookieJar = new tough.CookieJar();
//   const cookie1 = new tough.Cookie({
//     key: 'token',
//     value: cookies.token,
//     domain: DOMAIN,
//     path: '/',
//   });
//   const cookie2 = new tough.Cookie({
//     key: 'deviceId',
//     value: cookies.deviceId,
//     domain: DOMAIN,
//     path: '/',
//   });
//   cookieJar.setCookie(cookie1, BASE_URL);
//   cookieJar.setCookie(cookie2, BASE_URL);

//   let data = {
//     data:[],
//     err:null
//   };

//   // اضافه کردن کوکی‌ها به درخواست
//       await axios.post(`${BASE_URL}/user/payment/verifyNextPay`,context.query,{
//         headers: {
//           Cookie: cookieJar.getCookieStringSync(BASE_URL),
//         },
//         withCredentials:true
//       }).then(response => {
//           if(response.data.success){
//               data.data = response.data.data 
//           }else{
//             data.err = response.data.messgae
//               // console.log(response.data)
//           }
//       }).catch(err => {
//           console.log(err.messgae)
//       })


//   // ارسال داده به کامپوننت
//   return {
//     props: {
//       data,
//     },
//   };
// }